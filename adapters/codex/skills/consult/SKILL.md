<!-- AUTO-GENERATED by scripts/gen-adapters.js - DO NOT EDIT -->
---
name: consult
description: "Use when user asks to \"consult gemini\", \"ask codex\", \"get second opinion\", \"cross-check with claude\", \"consult another AI\", \"ask opencode\", \"copilot opinion\". Queries another AI CLI tool and returns the response."
---

# /consult - Cross-Tool AI Consultation

Get a second opinion from another AI CLI tool without leaving your current session.

## Constraints

- NEVER expose API keys in commands or output
- NEVER run with permission-bypassing flags (`--dangerously-skip-permissions`, `bypassPermissions`)
- MUST use safe-mode defaults (`-a suggest` for Codex, `--allowedTools "Read,Glob,Grep"` for Claude)
- MUST enforce 120s timeout on all tool executions
- MUST validate `--tool` against allow-list: gemini, codex, claude, opencode, copilot (reject all others)
- MUST validate `--context=file=PATH` is within the project directory (reject absolute paths outside cwd)
- MUST quote all user-provided values in shell commands to prevent injection
- NEVER execute tools the user has not explicitly requested

## Arguments

Parse from $ARGUMENTS:

- **question**: What to ask the consulted tool (required unless --continue)
- **--tool**: Target tool: `gemini`, `codex`, `claude`, `opencode`, `copilot` (interactive picker if omitted)
- **--effort**: Thinking effort: `low`, `medium`, `high`, `max` (interactive picker if omitted)
- **--model**: Specific model name (overrides effort-based selection). Free text.
- **--context**: Auto-include context: `diff` (git diff), `file=PATH` (attach specific file), `none` (default)
- **--continue**: Continue last consultation session, or `--continue=SESSION_ID` for specific session

## Execution

### Phase 1: Parse Arguments

Extract from `$ARGUMENTS`:

```javascript
const args = '$ARGUMENTS';
// Extract flags
const toolMatch = args.match(/--tool[=\s]+(\w+)/);
const effortMatch = args.match(/--effort[=\s]+(low|medium|high|max)/);
const modelMatch = args.match(/--model[=\s]+("[^"]+"|[\S]+)/);
const contextMatch = args.match(/--context[=\s]+(diff|file=[^\s]+|none)/);
const continueMatch = args.match(/--continue(?:[=\s]+(\S+))?/);
// Question is everything except flags
const question = args.replace(/--\w+[=\s]+\S+/g, '').replace(/--continue/g, '').trim();
```

If no question and no `--continue`:
```
[ERROR] Usage: /consult "your question" [--tool=gemini|codex|claude|opencode|copilot] [--effort=low|medium|high|max]
```

### Phase 2: Interactive Parameter Selection

Resolve missing parameters interactively. If ALL flags are provided, skip directly to Phase 3.

#### Step 2a: Handle --continue

If `--continue` is set, load last session state:

```javascript
const stateDir = process.env.AI_STATE_DIR || '.claude';
const sessionFile = `${stateDir}/consult/last-session.json`;
// Read session file. If found, restore tool + session_id + model.
// If not found, warn and proceed as fresh consultation.
```

#### Step 2b: Tool Selection (if no --tool)

Detect installed tools via Bash. Run **all 5 in parallel**:

- Windows: `where.exe claude 2>nul && echo FOUND || echo NOTFOUND`
- Windows: `where.exe gemini 2>nul && echo FOUND || echo NOTFOUND`
- Windows: `where.exe codex 2>nul && echo FOUND || echo NOTFOUND`
- Windows: `where.exe opencode 2>nul && echo FOUND || echo NOTFOUND`
- Windows: `where.exe copilot 2>nul && echo FOUND || echo NOTFOUND`

Unix equivalent: replace `where.exe` with `which`, `2>nul` with `2>/dev/null`.

Collect results. Build AskUserQuestion options using **only installed tools**:

```
AskUserQuestion:
  header: "AI Tool"
  question: "Which AI tool should I consult?"
  multiSelect: false
  options (only if installed):
    - label: "Claude"       description: "Deep code reasoning"
    - label: "Gemini"       description: "Fast multimodal analysis"
    - label: "Codex"        description: "Agentic coding"
    - label: "OpenCode"     description: "Flexible model choice"
    - label: "Copilot"      description: "GitHub-integrated AI"
```

If zero tools installed: `[ERROR] No AI CLI tools found. Install at least one: npm i -g @anthropic-ai/claude-code, npm i -g @openai/codex, npm i -g opencode-ai`

Map user's choice to lowercase tool name (e.g. "Claude" -> "claude").

#### Step 2c: Effort Selection (if no --effort)

```
AskUserQuestion:
  header: "Effort"
  question: "What thinking effort level?"
  multiSelect: false
  options:
    - label: "Medium (Recommended)"  description: "Balanced speed and quality"
    - label: "Low"                   description: "Fast, minimal reasoning"
    - label: "High"                  description: "Thorough analysis"
    - label: "Max"                   description: "Maximum reasoning depth"
```

Map user's choice: "Medium (Recommended)" -> "medium", "Low" -> "low", "High" -> "high", "Max" -> "max".

### Phase 3: Invoke Consult Skill

With all parameters resolved (tool, effort, question, model, context, continue), invoke the `consult` skill:

```
Skill: consult
Args: "<question>" --tool=<tool> --effort=<effort> [--model=<model>] [--context=<context>] [--continue=<session_id>]
```

The skill provides provider-specific configuration: command template, model mapping, output parsing method, and session management.

### Phase 4: Execute CLI Command

Follow the skill's instructions to:

1. **Resolve model** from effort level (or use --model override)
2. **Build the CLI command** using the provider's command template
3. **Package context** if --context=diff or --context=file=PATH
4. **Shell-escape** all user-provided values
5. **Execute via Bash** with 120-second timeout

### Phase 5: Present Results

Parse the tool's output per the skill's provider-specific parsing instructions.

Display:

```markdown
[OK] Consultation Complete

**Tool**: {tool} ({model})
**Effort**: {effort}
**Duration**: {duration}s

### Response

{formatted response from the consulted tool}

### Session

{if continuable: "Session: {session_id} - use `/consult --continue` to resume"}
```

Save session state for continuable tools (Claude, Gemini) to `{AI_STATE_DIR}/consult/last-session.json`.

On failure: `[ERROR] Consultation Failed: {error message}`

## Error Handling

| Error | Action |
|-------|--------|
| No question provided | Show usage help |
| Tool not installed | Show install instructions (from skill) |
| Tool execution fails | Show error, suggest alternative tool |
| Timeout (>120s) | Kill process, show partial output if any |
| No tools available | Show install instructions for all tools |
| Session not found | Warn, start fresh consultation |
| API key missing | Show tool-specific env var instructions (from skill) |

## Example Usage

```bash
/consult "Is this the right approach for error handling?" --tool=gemini --effort=high
/consult "Review this function for performance issues" --tool=codex
/consult "What alternative patterns would you suggest?" --tool=claude --effort=max
/consult "Suggest improvements" --tool=opencode --model=github-copilot/claude-opus-4-6
/consult "Continue from where we left off" --continue
/consult "Explain this error" --context=diff --tool=gemini
/consult "Review this file" --context=file=src/index.js --tool=claude
```
